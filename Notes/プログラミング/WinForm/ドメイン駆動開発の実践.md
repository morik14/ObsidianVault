---
tags:
  - ソースコード
  - CSharp
  - WinForm
  - プログラミング
---
# ドメイン駆動開発の実践

## プロジェクト作成

- DDD.WinFormでプロジェクト作成 
- DDD.Domainを追加
- DDD.Infrastracture を追加 
- DDDTest.Testsを追加

## 依存関係を設定

「参照」を右クリック→「参照の追加」

![[Pasted image 20240511225224.png]]

フォルダ構成は[[ドメイン駆動開発のアーキテクチャについて#フォルダー構成]]

## 事前準備

- ChainingAssertionのインストール
- Moqのインストール 

## Domainプロジェクト

### ValueObjects フォルダー（データベースの列）

ValueObjectクラス（コピペ） 

```c#
namespace DDD.Domain.ValueObjects
{
    public abstract class ValueObject<T> where T : ValueObject<T>
    {
        public override bool Equals(object obj)
        {
            var vo = obj as T;
            if (vo == null)
            {
                return false; 
            }

            return EqualsCore(vo);
        }

        public static bool operator ==(ValueObject<T> vol,
            ValueObject<T> vo2)
        {
            return Equals(vol, vo2);
        }

        public static bool operator !=(ValueObject<T> vol,
            ValueObject<T> vo2)
        {
            return !Equals(vol, vo2);
        }

        protected abstract bool EqualsCore(T other);

        public override string ToString()
        {
            return base.ToString();
        }

        public override int GetHashCode()
        {
            return base.GetHashCode();
        }
    }
}
```

AreaId クラス

```c#
namespace DDD.Domain.ValueObjects
{
    public sealed class AreaId : ValueObject<AreaId>
    {
        public AreaId(int value)
        {
            Value = value;
        }

        public int Value { get; }

        public string DisplayValue => Value.ToString().PadLeft(4, '0');

        protected override bool EqualsCore(AreaId other)
        {
            return this.Value == other.Value;
        }
    }
}
```

MeasureDate クラス

```c#
namespace DDD.Domain.ValueObjects
{
    public sealed class MeasureDate : ValueObject<MeasureDate>
    {
        public MeasureDate(DateTime value)
        {
            Value = value;
        }

        public DateTime Value { get; }

        public string DisplayValue => Value.ToString("yyyy/MM/dd HH:mm:ss");

        protected override bool EqualsCore(MeasureDate other)
        {
            return this.Value == other.Value;
        }
    }
}
```

MeasureValue クラス

```c#
namespace DDD.Domain.ValueObjects
{
    public sealed class MeasureValue : ValueObject<MeasureValue>
    {
        public MeasureValue(float value)
        {
            Value = value;
        }

        public float Value { get; }

        public string DisplayValue => Math.Round(Value, 2) + "°C";

        protected override bool EqualsCore(MeasureValue other)
        {
            return this.Value == other.Value;
        }
    }
}
```

### Entitiesフォルダー（データベースの行）

MeasureEntity クラス

```c#
namespace DDD.Domain.Entities
{
    // Entityは継承させない
    public sealed class MeasureEntity
    {
        public MeasureEntity(
            int areaId, 
            DateTime measureDate, 
            float measureValue
            )
        {
            AreaId = new AreaId(areaId);
            MeasureDate = new MeasureDate(measureDate);
            MeasureValue = new MeasureValue(measureValue);
        }

        public AreaId AreaId { get; }
        public MeasureDate MeasureDate { get; }
        public MeasureValue MeasureValue { get; }
    }
}
```


## Infrastrcture フォルダー
## WinForm プロジェクト

### ViewModelフォルダー

ViewModelBase クラス

```c#
namespace DDD.WinForm.ViewModels
{
    public abstract class ViewModelBase : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;

        protected bool SetProperty<T>(ref T field, T value, [CallerMemberName] string propertyName = null)
        {
            if (Equals(field, value)) return false;
            field = value;
            var h = this.PropertyChanged;
            if (h != null)
            {
                h(this, new PropertyChangedEventArgs(propertyName));
            }

            return true;
        }

        public virtual DateTime GetDateTime()
        {
            return DateTime.Now;
        }

        public void OnPropertyChanged()
        {
            PropertyChanged.Invoke(this, new PropertyChangedEventArgs(""));
        }
    }
}
```